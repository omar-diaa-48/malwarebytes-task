import React, { useEffect, useState } from 'react'
import { SpeedDial, Tooltip } from "@mui/material";
import ShoppingCartIcon from '@mui/icons-material/ShoppingCart';
import { useAppDispatch, useAppSelector } from '../../store/hooks';
import { RootState } from '../../store';
import { openModalAction } from '../../store/slices/app';
import { toast } from 'react-toastify';

const CartIcon = () => {
	const dispatch = useAppDispatch();
	const { items } = useAppSelector((state: RootState) => state.cart)

	const [itemsInCartCount, setItemsInCartCount] = useState<number>(0);

	useEffect(() => {
		setItemsInCartCount(Object.keys(items).length);
	}, [items])

	const handleClick = () => {
		if (itemsInCartCount < 1) {
			toast("Cart is empty, start shopping now!", { type: "error" })
		}
		else {
			dispatch(openModalAction({ current: "cart-modal", args: {} }))
		}
	}

	return (
		<Tooltip title={itemsInCartCount < 1 ? 'No items in cart' : 'Click to view items in cart'}>
			<SpeedDial
				ariaLabel="Cart button"
				className='absolute bottom-4 right-4'
				icon={<ShoppingCartIcon />}
				onClick={handleClick}
			/>
		</Tooltip>
	)
}

export default CartIcon