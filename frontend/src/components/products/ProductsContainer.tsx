import React, { useEffect } from 'react'
import useApiPost from '../../hooks/use-api-hook'
import { GroupedProducts } from '../../interfaces/responses/product'
import { AxiosResponseDataType } from '../../utils/types'
import ErrorFallback from '../shared/ErrorFallback'
import Loader from '../shared/Loader'
import GroupedProductsComponent from './GroupedProducts'

const ProductsContainerComponent = () => {
	const { cancel, data, error, loaded } = useApiPost<AxiosResponseDataType<GroupedProducts>>('/products', "get", {})

	useEffect(() => {
		() => {
			cancel();
		}
	}, [])

	if (!loaded) {
		return (
			<Loader />
		)
	}

	if (error) {
		return (
			<ErrorFallback />
		)
	}

	return (
		<div className="container flex flex-col items-center justify-center w-full xl:w-1/2 mx-auto bg-white rounded-lg shadow">
			<div className="w-full px-4 py-5 border-b sm:px-6 mb-4">
				<h3 className="text-lg font-medium leading-6 text-gray-900">
					Available products
				</h3>
				<p className="max-w-2xl mt-1 text-sm text-gray-500">
					Details and informations about produts and their categories.
				</p>
			</div>
			<ul className="w-full flex flex-col px-4 sm:px-6">
				{
					data?.data && (
						<GroupedProductsComponent data={data.data} />
					)
				}
			</ul>
		</div>
	)
}

export default ProductsContainerComponent