import { Alert, CircularProgress, Tooltip } from '@mui/material'
import React, { useEffect } from 'react'
import { Link, useNavigate } from 'react-router-dom'
import { RootState } from '../../store'
import { useAppSelector } from '../../store/hooks'
import { BaseProps } from '../../utils/types'
import userOnboardSteps from '../../utils/user-onboard'
import CustomTooltip from '../shared/CustomTooltip'

interface AuthPageContainerProps extends BaseProps {
	type: "login" | "register"
}

const AUTH_PAGE_TYPES = {
	"login": {
		title: "Login",
		or: {
			title: "Or Register",
			link: "/register",
		},
		userOnboardContent: userOnboardSteps[0].content
	},
	"register": {
		title: "Register",
		or: {
			title: "Or Login",
			link: "/login",
		},
		userOnboardContent: userOnboardSteps[0].content
	}
}

const AuthPageContainer: React.FC<AuthPageContainerProps> = ({ type, children }) => {
	const navigate = useNavigate();
	const { isAuthenticated } = useAppSelector((state: RootState) => state.user)

	useEffect(() => {
		let timerId: NodeJS.Timeout;

		if (isAuthenticated) {
			timerId = setTimeout(() => {
				navigate('/')
			}, 1000);
		}

		() => {
			clearTimeout(timerId)
		}
	}, [isAuthenticated])

	if (isAuthenticated) {
		return (
			<div className='w-full h-screen'>
				<div className='w-1/2 mx-auto flex flex-col items-center justify-center gap-2 p-6'>
					<Alert variant="outlined" severity="info">
						<span>Seems like you are already in! </span>
					</Alert>
					<CircularProgress />
				</div>
			</div>
		)
	}

	return (
		<section className="h-screen">
			<div className="px-6 h-full text-gray-800">
				<div className="flex justify-center items-center flex-wrap h-full g-6">
					<div className="xl:w-5/12 lg:w-5/12 md:w-8/12 mb-12 md:mb-0">
						<div className="flex flex-row items-center justify-center lg:justify-start">
							<p className="mb-0 mr-4 text-lg">{AUTH_PAGE_TYPES[type].title}</p>
						</div>

						<CustomTooltip title={AUTH_PAGE_TYPES[type].userOnboardContent}>
							<div className="my-4 flex items-center before:mt-0.5 before:flex-1 before:border-t before:border-neutral-300 after:mt-0.5 after:flex-1 after:border-t after:border-neutral-300">
								<Link to={AUTH_PAGE_TYPES[type].or.link} className="mx-4 mb-0 text-center font-semibold">
									{AUTH_PAGE_TYPES[type].or.title}
								</Link>
							</div>
						</CustomTooltip>

						{children}
					</div>
				</div>
			</div>
		</section>
	)
}

export default AuthPageContainer