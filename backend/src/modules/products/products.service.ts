import { Injectable } from '@nestjs/common';
import { InjectModel } from '@nestjs/mongoose';
import { Model } from "mongoose";
import { ProductItem } from 'src/models/product-item';
import { ProductCategory } from 'src/models/product-category';

@Injectable()
export class ProductsService {
	constructor(
		@InjectModel('ProductItem') private productItemModel: Model<ProductItem>,
		@InjectModel('ProductCategory') private productCategoryModel: Model<ProductCategory>,
	) { }

	async findAllProucts(): Promise<{ [key: string]: ProductItem[] }> {
		const products = await this.productItemModel.find({}).populate("productCategory")

		const groupedProducts = {}

		products.forEach((product) => {
			if (groupedProducts[product.productCategory.title]) {
				groupedProducts[product.productCategory.title].push(product)
			}
			else {
				groupedProducts[product.productCategory.title] = [product]
			}
		})

		return groupedProducts;
	}
}