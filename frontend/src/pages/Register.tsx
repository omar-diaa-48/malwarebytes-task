import { useNavigate, Link } from 'react-router-dom';
import { yupResolver } from "@hookform/resolvers/yup";
import { FormProvider, useForm } from 'react-hook-form';
import { authDefaultValues, authSchema } from "../interfaces/schemes/auth";
import { IAuthDto } from "../interfaces/dtos/auth";
import api from "../utils/api";
import AuthForm from "../components/authentication/AuthForm";
import { useAppDispatch } from '../store/hooks';
import { loginAsyncAction, registerAsyncAction } from '../store/slices/user';
import AuthPageContainer from '../components/authentication/AuthPageContainer';

const Register = () => {
	const navigate = useNavigate();
	const dispatch = useAppDispatch();

	const methods = useForm<IAuthDto>({
		mode: "onChange",
		defaultValues: authDefaultValues,
		resolver: yupResolver(authSchema)
	});

	const registerCallback = (values: IAuthDto) => {
		dispatch(registerAsyncAction(values))
			.then((data) => {
				if (data.meta.requestStatus === "fulfilled") {
					navigate('/')
				}
			})
	};

	return (
		<AuthPageContainer type='register'>
			<FormProvider {...methods}>
				<AuthForm submitAction={registerCallback} />
			</FormProvider>
		</AuthPageContainer>
	)
}

export default Register;