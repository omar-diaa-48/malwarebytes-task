import { Injectable, NotFoundException } from '@nestjs/common';
import { UserService } from '../user/user.service';
import { AuthDto } from './auth.dto';
import { JwtPayload } from './dto/jwt-payload';

@Injectable()
export class AuthService {
	constructor(
		private userService: UserService,
	) { }

	async signin(dto: AuthDto): Promise<JwtPayload> {
		const { username, password } = dto;

		const user = await this.userService.findUserByUserName(username);

		if (!user) {
			throw new NotFoundException("User with this name not found")
		}

		if (user.password !== password) {
			throw new NotFoundException("User credentials is incorrect, please try again")
		}

		const payload: JwtPayload = {
			id: username,
			username: username,
		}

		return payload;
	}
}