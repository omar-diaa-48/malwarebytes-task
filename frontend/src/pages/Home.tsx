import { Tooltip } from '@mui/material'
import React, { useEffect } from 'react'
import ErrorFallback from '../components/shared/ErrorFallback'
import Loader from '../components/shared/Loader'
import useApiPost from '../hooks/use-api-hook'
import { GroupedProducts } from '../interfaces/responses/product'
import { AxiosResponseDataType } from '../utils/types'

const Home = () => {
	const { cancel, data, error, loaded } = useApiPost<AxiosResponseDataType<GroupedProducts>>('/products', "get", {})

	useEffect(() => {
		() => {
			cancel();
		}
	}, [])

	if (!loaded) {
		return (
			<Loader />
		)
	}

	if (error) {
		return (
			<ErrorFallback />
		)
	}

	return (
		<div className="container flex flex-col items-center justify-center w-full lg:w-1/2 mx-auto bg-white rounded-lg shadow">
			<div className="w-full px-4 py-5 border-b sm:px-6 mb-4">
				<h3 className="text-lg font-medium leading-6 text-gray-900">
					Available products
				</h3>
				<p className="max-w-2xl mt-1 text-sm text-gray-500">
					Details and informations about produts and their categories.
				</p>
			</div>
			<ul className="flex flex-col">
				{
					data?.data && (
						Object.keys(data.data).map((groupTitle) => (
							<li key={groupTitle} className="flex flex-col mb-2 border-gray-400">
								<p className='text-blue-500'>{groupTitle}</p>
								<ul>
									{data.data[groupTitle].map((product) => (
										<li key={product._id}>
											<div className="transition duration-500 shadow ease-in-out transform hover:-translate-y-1 hover:shadow-lg select-none cursor-pointer bg-white rounded-md flex flex-1 items-center p-4">
												<div className="flex-1 pl-1 md:mr-16">
													<p className="font-medium">
														{product.title}
													</p>
												</div>
												<Tooltip title={product.description}>
													<p className="text-xs text-gray-600 truncate ...">
														{product.description.slice(0, 35)}
													</p>
												</Tooltip>
												<button className="flex justify-end w-24 text-right">
													<svg width="12" fill="currentColor" height="12" className="text-gray-500 hover:text-gray-800" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg">
														<path d="M1363 877l-742 742q-19 19-45 19t-45-19l-166-166q-19-19-19-45t19-45l531-531-531-531q-19-19-19-45t19-45l166-166q19-19 45-19t45 19l742 742q19 19 19 45t-19 45z">
														</path>
													</svg>
												</button>
											</div>
										</li>
									))}
								</ul>
							</li>
						))
					)
				}
			</ul>
		</div>

	)
}

export default Home