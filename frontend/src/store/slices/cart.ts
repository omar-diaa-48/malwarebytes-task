import { createSlice } from "@reduxjs/toolkit";
import { ProductItem } from "../../interfaces/responses/product";
import { ActionPayloadType } from "../../utils/types";

export interface CartState {
	items: {
		[key: string]: {
			title: string;
			countInCart: number
		}
	}
}

const initialState = {
	items: {}
} as CartState;

export const cartSlice = createSlice({
	name: 'cart',
	initialState,
	reducers: {
		clearCartAction: (state: CartState, action: ActionPayloadType<void>) => {
			return {
				...initialState
			}
		},

		addItemToCart: (state: CartState, action: ActionPayloadType<{ item: ProductItem }>) => {
			const { item } = action.payload;

			let countInCart = 0;

			if (state.items[item._id]) {
				countInCart = state.items[item._id].countInCart;
			}

			countInCart++;

			return {
				...state,
				items: {
					...state.items,
					[item._id]: {
						title: item.title,
						countInCart
					}
				}
			}
		},

		removeItemFromCart: (state: CartState, action: ActionPayloadType<{ item: ProductItem }>) => {
			const { item } = action.payload;

			let countInCart = 0;

			if (state.items[item._id]) {
				countInCart = state.items[item._id].countInCart;
			}

			if (countInCart > 0) {
				countInCart--;
			}

			return {
				...state,
				items: {
					...state.items,
					[item._id]: {
						title: item.title,
						countInCart
					}
				}
			}
		},
	},
	extraReducers: {}
})

export const { clearCartAction, addItemToCart, removeItemFromCart } = cartSlice.actions

export default cartSlice.reducer